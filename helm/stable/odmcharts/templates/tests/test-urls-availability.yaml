apiVersion: v1
kind: Pod
metadata:
  name: {{ template "odm.test.fullname" . }}
  labels:
    app: {{ template "fullname" . }}
    chart: "{{ .Chart.Name }}-{{ .Chart.Version }}"
    heritage: "{{ .Release.Service }}"
    release: "{{ .Release.Name }}"
  annotations:
    "helm.sh/hook": test-success
spec:
  containers:
    - name: test-framework
      image: websphere-liberty:webProfile7
      command: [
        "sh", "/tests/suite.sh"
      ]
      env:
        - name: DBSERVER
          value: {{ template "odm.dbserver.fullname" . }}
        - name: DECISIONSERVERCONSOLE
          value: {{ template "odm.decisionserverconsole.fullname" . }}
        - name: DECISIONSERVERRUNTIME
          value: {{ template "odm.decisionserverruntime.fullname" . }}
        - name: DECISIONCENTER
          value: {{ template "odm.decisioncenter.fullname" . }}
        - name: DECISIONRUNNER
          value: {{ template "odm.decisionrunner.fullname" . }}
        - name: PERSISTENCECLAIM
          value: {{ template "odm.persistenceclaim.fullname" . }}
      volumeMounts:
        - name: tests
          mountPath: /tests
  volumes:
    - name: tests
      configMap:
        name: {{ template "fullname" . }}-configmap-files-loading
  restartPolicy: Never
